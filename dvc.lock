schema: '2.0'
stages:
  prepare_stack:
    cmd: python3 -m src.stack.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: 59bae5f83c275d47d1de1b421cc0c904.dir
      size: 356813768
      nfiles: 74
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 0c8000140097a7ecab0b541e53d006fe
      size: 8437
    - path: src/generators/swiss_license_plates_generator.py
      md5: 5eca5b809dccadee29f64a29a2ee3199
      size: 12384
    - path: src/stack/prepare.py
      md5: db7ea963910431722f25367541a5bb6e
      size: 1188
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        PrepareOCRParams:
          SEED: 25032023
          MAX_IMAGES: 250000
          TRAIN_SPLIT: 0.8
          IMG_SIZE:
          - 256
          - 256
        PrepareStackParams:
          SEED: 25032023
          MAX_IMAGES: 5000
    outs:
    - path: data/prepared/stack
      md5: 1fb444c7c25ef691824a889ac6ac4ba9.dir
      size: 221542631
      nfiles: 1
  prepare_localize:
    cmd: python3 -m src.localize.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: 59bae5f83c275d47d1de1b421cc0c904.dir
      size: 356813768
      nfiles: 74
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 0c8000140097a7ecab0b541e53d006fe
      size: 8437
    - path: src/generators/swiss_license_plates_generator.py
      md5: 5eca5b809dccadee29f64a29a2ee3199
      size: 12384
    - path: src/localize/prepare.py
      md5: cb5cf77073d2715b6c78181d55651c4c
      size: 1789
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        PrepareLocalizeParams:
          SEED: 25032023
          MAX_IMAGES: 100000
          TRAIN_SPLIT: 0.8
    outs:
    - path: data/prepared/localize
      md5: ea5ebff6ef5f8f0fe28eae0a75c09fec.dir
      size: 443085970
      nfiles: 2
    - path: out/prepared/localize/plots/images
      md5: 3245740c012c1e4f889a90571ef3de91.dir
      size: 19887
      nfiles: 5
  train_localize:
    cmd: python3 -m src.localize.train
    deps:
    - path: data/prepared/localize
      md5: ea5ebff6ef5f8f0fe28eae0a75c09fec.dir
      size: 443085970
      nfiles: 2
    - path: src/localize/train.py
      md5: 33d2275a98adb090742e5a5df7b5e5b9
      size: 1279
    - path: src/models/cnn_localizer_model.py
      md5: a380c4d202c6bcd726d923df1cbf2de1
      size: 3330
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    - path: src/utils/train.py
      md5: 3f001032823f9b609f598054d7150b8e
      size: 3975
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.4
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        TrainLocalizeParams:
          SEED: 25032023
          LR: 0.001
          EPOCHS: 3
    outs:
    - path: out/checkpoints/localize
      md5: d07292170e83ec5d0c3b164bf9035316.dir
      size: 33479563
      nfiles: 1
    - path: out/models/localize
      md5: 638933070242b64800a3e8a5d914870f.dir
      size: 33478619
      nfiles: 1
    - path: out/runs/localize/metrics.json
      md5: ecd166eaeab92bfec5b41b623dbe93d9
      size: 140
    - path: out/runs/localize/plots/metrics
      md5: f83ee71a68972ddf607692b63a831f0c.dir
      size: 66
      nfiles: 2
    - path: out/runs/localize/tensorboard
      md5: be81d87a5b368406ca3d43b54d530dac.dir
      size: 252
      nfiles: 3
  prepare_ocr:
    cmd: python3 -m src.ocr.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: 59bae5f83c275d47d1de1b421cc0c904.dir
      size: 356813768
      nfiles: 74
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 0c8000140097a7ecab0b541e53d006fe
      size: 8437
    - path: src/datasets/swiss_license_plates_ocr_dataset.py
      md5: 1145dd87bb216ae5c754d4cee6fca1cd
      size: 2921
    - path: src/generators/swiss_license_plates_generator.py
      md5: 5eca5b809dccadee29f64a29a2ee3199
      size: 12384
    - path: src/ocr/prepare.py
      md5: 09134431f4b97c3810748e17f986ad8c
      size: 1809
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 7
          GRU_NUM_CLASSES: 37
          GRU_BLANK_CLASS: 36
        PrepareOCRParams:
          SEED: 25032023
          MAX_IMAGES: 250000
          TRAIN_SPLIT: 0.8
          IMG_SIZE:
          - 256
          - 256
    outs:
    - path: data/prepared/ocr
      md5: 36502fe05d61b06734cb7fe92c2c7967.dir
      size: 443088146
      nfiles: 2
    - path: out/prepared/ocr/plots/images
      md5: 3b94af765b5f3e64561723d80ae53021.dir
      size: 16775
      nfiles: 5
  train_ocr:
    cmd: python3 -m src.ocr.train
    deps:
    - path: data/prepared/ocr
      md5: 36502fe05d61b06734cb7fe92c2c7967.dir
      size: 443088146
      nfiles: 2
    - path: src/models/cnn_ocr_model.py
      md5: d672a8524c6d769f9646d65193934bac
      size: 4353
    - path: src/ocr/train.py
      md5: 16b96a7c74f4134c9ad6b2d4095e45f1
      size: 1239
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    - path: src/utils/train.py
      md5: 3f001032823f9b609f598054d7150b8e
      size: 3975
    params:
      params.py:
        BATCH_SIZE: 32
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 18
          - 18
          GRU_HIDDEN_SIZE: 384
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.5
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 7
          GRU_NUM_CLASSES: 37
          GRU_BLANK_CLASS: 36
        TrainOCRParams:
          SEED: 25032023
          LR: 0.00025
          EPOCHS: 2
    outs:
    - path: out/checkpoints/ocr
      md5: 5c1c7515f48dec177f3940e114dd8214.dir
      size: 60621027
      nfiles: 1
    - path: out/models/ocr
      md5: 2038e62af0ee1d9fe02a0111beec0ba9.dir
      size: 60619231
      nfiles: 1
    - path: out/runs/ocr/metrics.json
      md5: 8f04e62149de07fa78e8a6609cf9e7fc
      size: 135
    - path: out/runs/ocr/plots/metrics
      md5: 3426895322dfc4d84d4a3be0b3d0b894.dir
      size: 61
      nfiles: 2
    - path: out/runs/ocr/tensorboard
      md5: afcb3d90f979121f4b638ed67e5ee19d.dir
      size: 252
      nfiles: 3
  evaluate_stack:
    cmd: python3 -m src.stack.evaluate
    deps:
    - path: data/prepared/stack
      md5: 1fb444c7c25ef691824a889ac6ac4ba9.dir
      size: 221542631
      nfiles: 1
    - path: out/models/localize
      md5: 638933070242b64800a3e8a5d914870f.dir
      size: 33478619
      nfiles: 1
    - path: out/models/ocr
      md5: 2038e62af0ee1d9fe02a0111beec0ba9.dir
      size: 60619231
      nfiles: 1
    - path: src/stack/evaluate.py
      md5: 6c45ddbb357fcaf11ad135e5b9ec921e
      size: 5196
    - path: src/utils/evaluation.py
      md5: 05207364c9c9e12f46eb6ba07efa051a
      size: 1569
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/preview.py
      md5: a0538f1dd2c1ecc5184a13a746bda674
      size: 573
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.4
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 18
          - 18
          GRU_HIDDEN_SIZE: 384
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.5
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 7
          GRU_NUM_CLASSES: 37
          GRU_BLANK_CLASS: 36
    outs:
    - path: out/evaluations/stack/metrics.json
      md5: a42e63eef8befa6394831b648b206fd6
      size: 22
    - path: out/evaluations/stack/plots/images
      md5: a6fc29eae38016b814d32c34f51f54f6.dir
      size: 1235236
      nfiles: 8
  evaluate_ocr:
    cmd: python3 -m src.ocr.evaluate
    deps:
    - path: out/models/ocr
      md5: 2038e62af0ee1d9fe02a0111beec0ba9.dir
      size: 60619231
      nfiles: 1
    - path: src/ocr/evaluate.py
      md5: 9f60a78ad71249434e1c981a714db2bc
      size: 2667
    - path: src/utils/evaluation.py
      md5: 05207364c9c9e12f46eb6ba07efa051a
      size: 1569
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 18
          - 18
          GRU_HIDDEN_SIZE: 384
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.5
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 7
          GRU_NUM_CLASSES: 37
          GRU_BLANK_CLASS: 36
    outs:
    - path: out/evaluations/ocr/plots/images
      md5: 686b5c6bffb7d4938f8dfd224ca7894e.dir
      size: 585039
      nfiles: 10
  evaluate_localize:
    cmd: python3 -m src.localize.evaluate
    deps:
    - path: out/models/localize
      md5: 638933070242b64800a3e8a5d914870f.dir
      size: 33478619
      nfiles: 1
    - path: src/localize/evaluate.py
      md5: 6cbcb8c8d63d928616302a55a1653bdc
      size: 1739
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/preview.py
      md5: a0538f1dd2c1ecc5184a13a746bda674
      size: 573
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.4
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
    outs:
    - path: out/evaluations/localize/plots/images
      md5: 23e1768540ba656e6ad90b4250b2edb4.dir
      size: 67955
      nfiles: 10
