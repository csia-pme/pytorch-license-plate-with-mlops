schema: '2.0'
stages:
  prepare_stack:
    cmd: python3 -m src.stack.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: fd29c6762b7ca129424e98d096800055.dir
      size: 356810637
      nfiles: 72
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 7aa8b1c7f0a67eaeb6ee6820577ae13a
      size: 8416
    - path: src/generators/swiss_license_plates_generator.py
      md5: 57e2598a814dd0b44c3d124d024c5096
      size: 12376
    - path: src/stack/prepare.py
      md5: db7ea963910431722f25367541a5bb6e
      size: 1188
    - path: src/utils/dataset.py
      md5: f9d896d736c3324bf8d256f4425a66fd
      size: 2267
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        PrepareOCRParams:
          SEED: 25032023
          MAX_IMAGES: 5000
          TRAIN_SPLIT: 0.8
          IMG_SIZE:
          - 256
          - 256
        PrepareStackParams:
          SEED: 25032023
          MAX_IMAGES: 5000
    outs:
    - path: data/prepared/stack
      md5: 2ccfed4ac435dc040db0fbc6aee2cba2.dir
      size: 221542823
      nfiles: 1
  prepare_localize:
    cmd: python3 -m src.localize.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: fd29c6762b7ca129424e98d096800055.dir
      size: 356810637
      nfiles: 72
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 7aa8b1c7f0a67eaeb6ee6820577ae13a
      size: 8416
    - path: src/generators/swiss_license_plates_generator.py
      md5: 57e2598a814dd0b44c3d124d024c5096
      size: 12376
    - path: src/localize/prepare.py
      md5: cb5cf77073d2715b6c78181d55651c4c
      size: 1789
    - path: src/utils/dataset.py
      md5: f9d896d736c3324bf8d256f4425a66fd
      size: 2267
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        PrepareLocalizeParams:
          SEED: 25032023
          MAX_IMAGES: 5000
          TRAIN_SPLIT: 0.8
    outs:
    - path: data/prepared/localize
      md5: babe871f35033e6bceb6df393618cfbe.dir
      size: 443100498
      nfiles: 2
    - path: out/prepared/localize/plots/images
      md5: 66ceaf828dd6e2c12c9ed1fde2a3b26d.dir
      size: 21234
      nfiles: 5
  train_localize:
    cmd: python3 -m src.localize.train
    deps:
    - path: data/prepared/localize
      md5: babe871f35033e6bceb6df393618cfbe.dir
      size: 443100498
      nfiles: 2
    - path: src/localize/train.py
      md5: 33d2275a98adb090742e5a5df7b5e5b9
      size: 1279
    - path: src/models/cnn_localizer_model.py
      md5: 1047c5fb81e8329a5c34678181c2e39f
      size: 3291
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    - path: src/utils/train.py
      md5: 88cc4d86c2078b743411d812d09d3643
      size: 4004
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 128
          - 256
          DROPOUT: 0.25
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        TrainLocalizeParams:
          SEED: 25032023
          LR: 0.001
          EPOCHS: 5
    outs:
    - path: out/models/localize
      md5: a8f9d506c7892fb19d5b326fa02a0fed.dir
      size: 12893787
      nfiles: 1
    - path: out/runs/localize/metrics.json
      md5: effb8d2d1d91ac33df4980ce6f0a487c
      size: 141
    - path: out/runs/localize/plots/metrics
      md5: 5576615ccc6e82e764a846896c9d3f92.dir
      size: 254
      nfiles: 2
    - path: out/runs/localize/tensorboard
      md5: 4ad5f9f8dbe8e3808c0e8ece9718831e.dir
      size: 1024
      nfiles: 3
  prepare_ocr:
    cmd: python3 -m src.ocr.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: fd29c6762b7ca129424e98d096800055.dir
      size: 356810637
      nfiles: 72
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 7aa8b1c7f0a67eaeb6ee6820577ae13a
      size: 8416
    - path: src/datasets/swiss_license_plates_ocr_dataset.py
      md5: 63b6da7bd9ef1936cb3c4af4c021463a
      size: 2857
    - path: src/generators/swiss_license_plates_generator.py
      md5: 57e2598a814dd0b44c3d124d024c5096
      size: 12376
    - path: src/ocr/prepare.py
      md5: 09134431f4b97c3810748e17f986ad8c
      size: 1809
    - path: src/utils/dataset.py
      md5: f9d896d736c3324bf8d256f4425a66fd
      size: 2267
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 6
          GRU_NUM_CLASSES: 11
          GRU_BLANK_CLASS: 10
        PrepareOCRParams:
          SEED: 25032023
          MAX_IMAGES: 5000
          TRAIN_SPLIT: 0.8
          IMG_SIZE:
          - 256
          - 256
    outs:
    - path: data/prepared/ocr
      md5: 29d0e2151aa7e327692bc7ff8e392583.dir
      size: 443102290
      nfiles: 2
    - path: out/prepared/ocr/plots/images
      md5: 3b6200a14ccce32d7af967ad365f453b.dir
      size: 18706
      nfiles: 5
  train_ocr:
    cmd: python3 -m src.ocr.train
    deps:
    - path: data/prepared/ocr
      md5: 29d0e2151aa7e327692bc7ff8e392583.dir
      size: 443102290
      nfiles: 2
    - path: src/models/cnn_ocr_model.py
      md5: 7dd0178eaf0e420d03a5d85d5b7af176
      size: 6123
    - path: src/ocr/train.py
      md5: 16b96a7c74f4134c9ad6b2d4095e45f1
      size: 1239
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    - path: src/utils/train.py
      md5: 88cc4d86c2078b743411d812d09d3643
      size: 4004
    params:
      params.py:
        BATCH_SIZE: 32
        OCRModelParams:
          MODEL_NAME: plate_ocr_v1
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          AVGPOOL_SIZE:
          - 4
          - 4
          RNN_HIDDEN_LAYERS:
          - 128
          - 256
          RNN_DROPOUT: 0.25
          GRU_HIDDEN_SIZE: 128
          GRU_NUM_LAYERS: 2
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 6
          GRU_NUM_CLASSES: 11
          GRU_BLANK_CLASS: 10
        TrainOCRParams:
          SEED: 25032023
          LR: 0.001
          EPOCHS: 10
    outs:
    - path: out/models/ocr
      md5: 73bffc7730f3525e517b762cab0d5c08.dir
      size: 10843276
      nfiles: 1
    - path: out/runs/ocr/metrics.json
      md5: be75256efb0216bd44f064ba8eea82ec
      size: 136
    - path: out/runs/ocr/plots/metrics
      md5: f745d0be5b0665a0806730d99352f3b3.dir
      size: 433
      nfiles: 2
    - path: out/runs/ocr/tensorboard
      md5: 15555b1947951610f77d0159e1702836.dir
      size: 1929
      nfiles: 3
  evaluate_stack:
    cmd: python3 -m src.stack.evaluate
    deps:
    - path: data/prepared/stack
      md5: 2ccfed4ac435dc040db0fbc6aee2cba2.dir
      size: 221542823
      nfiles: 1
    - path: out/models/localize
      md5: a8f9d506c7892fb19d5b326fa02a0fed.dir
      size: 12893787
      nfiles: 1
    - path: out/models/ocr
      md5: 73bffc7730f3525e517b762cab0d5c08.dir
      size: 10843276
      nfiles: 1
    - path: src/stack/evaluate.py
      md5: 62587542c37b1e99f4995b9ef129db97
      size: 5171
    - path: src/utils/evaluation.py
      md5: 9b3c547872ebd9fe24c062799c09e517
      size: 1237
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/preview.py
      md5: 92594901d3c3f97c8e77a6fed21471f5
      size: 547
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 128
          - 256
          DROPOUT: 0.25
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        OCRModelParams:
          MODEL_NAME: plate_ocr_v1
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          AVGPOOL_SIZE:
          - 4
          - 4
          RNN_HIDDEN_LAYERS:
          - 128
          - 256
          RNN_DROPOUT: 0.25
          GRU_HIDDEN_SIZE: 128
          GRU_NUM_LAYERS: 2
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 6
          GRU_NUM_CLASSES: 11
          GRU_BLANK_CLASS: 10
    outs:
    - path: out/evaluations/stack/metrics.json
      md5: fcee60999b7904c949423e5809afb534
      size: 40
    - path: out/evaluations/stack/plots/images
      md5: 79023a9a9cbca5cd3d464d9733d2d72f.dir
      size: 1107176
      nfiles: 11
  evaluate_ocr:
    cmd: python3 -m src.ocr.evaluate
    deps:
    - path: out/models/ocr
      md5: 73bffc7730f3525e517b762cab0d5c08.dir
      size: 10843276
      nfiles: 1
    - path: src/ocr/evaluate.py
      md5: a7feffe27fdf4fb43637fe28649979e4
      size: 2723
    - path: src/utils/evaluation.py
      md5: 9b3c547872ebd9fe24c062799c09e517
      size: 1237
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        OCRModelParams:
          MODEL_NAME: plate_ocr_v1
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          AVGPOOL_SIZE:
          - 4
          - 4
          RNN_HIDDEN_LAYERS:
          - 128
          - 256
          RNN_DROPOUT: 0.25
          GRU_HIDDEN_SIZE: 128
          GRU_NUM_LAYERS: 2
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 6
          GRU_NUM_CLASSES: 11
          GRU_BLANK_CLASS: 10
    outs:
    - path: out/evaluations/ocr/plots/images
      md5: 3002d0f4cd96532befddb4c18049200f.dir
      size: 595527
      nfiles: 10
  evaluate_localize:
    cmd: python3 -m src.localize.evaluate
    deps:
    - path: out/models/localize
      md5: a8f9d506c7892fb19d5b326fa02a0fed.dir
      size: 12893787
      nfiles: 1
    - path: src/localize/evaluate.py
      md5: 6cbcb8c8d63d928616302a55a1653bdc
      size: 1739
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/preview.py
      md5: 92594901d3c3f97c8e77a6fed21471f5
      size: 547
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 128
          - 256
          DROPOUT: 0.25
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
    outs:
    - path: out/evaluations/localize/plots/images
      md5: 444ae576b39a666da214f071bcf8ffaf.dir
      size: 66841
      nfiles: 10
