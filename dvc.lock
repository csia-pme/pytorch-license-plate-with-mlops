schema: '2.0'
stages:
  prepare_stack:
    cmd: python3 -m src.stack.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: fd29c6762b7ca129424e98d096800055.dir
      size: 356810637
      nfiles: 72
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: cb7ff1aa234850380b55a74e00004822
      size: 8454
    - path: src/generators/swiss_license_plates_generator.py
      md5: 2ae6514797d244ee438f93229198e595
      size: 12413
    - path: src/stack/prepare.py
      md5: db7ea963910431722f25367541a5bb6e
      size: 1188
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        PrepareOCRParams:
          SEED: 25032023
          MAX_IMAGES: 50000
          TRAIN_SPLIT: 0.8
          IMG_SIZE:
          - 256
          - 256
        PrepareStackParams:
          SEED: 25032023
          MAX_IMAGES: 5000
    outs:
    - path: data/prepared/stack
      md5: 0ce8cd175974654d7a785659b3746051.dir
      size: 221542823
      nfiles: 1
  prepare_localize:
    cmd: python3 -m src.localize.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: fd29c6762b7ca129424e98d096800055.dir
      size: 356810637
      nfiles: 72
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: cb7ff1aa234850380b55a74e00004822
      size: 8454
    - path: src/generators/swiss_license_plates_generator.py
      md5: 2ae6514797d244ee438f93229198e595
      size: 12413
    - path: src/localize/prepare.py
      md5: cb5cf77073d2715b6c78181d55651c4c
      size: 1789
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        PrepareLocalizeParams:
          SEED: 25032023
          MAX_IMAGES: 50000
          TRAIN_SPLIT: 0.8
    outs:
    - path: data/prepared/localize
      md5: 43812419451c55dd033f124cd8cd4639.dir
      size: 443235602
      nfiles: 2
    - path: out/prepared/localize/plots/images
      md5: 3e296a47a3da948b0c1702d2c397763b.dir
      size: 18643
      nfiles: 5
  train_localize:
    cmd: python3 -m src.localize.train
    deps:
    - path: data/prepared/localize
      md5: 43812419451c55dd033f124cd8cd4639.dir
      size: 443235602
      nfiles: 2
    - path: src/localize/train.py
      md5: 33d2275a98adb090742e5a5df7b5e5b9
      size: 1279
    - path: src/models/cnn_localizer_model.py
      md5: a380c4d202c6bcd726d923df1cbf2de1
      size: 3330
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    - path: src/utils/train.py
      md5: 3f001032823f9b609f598054d7150b8e
      size: 3975
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.25
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        TrainLocalizeParams:
          SEED: 25032023
          LR: 0.001
          EPOCHS: 5
    outs:
    - path: out/checkpoints/localize
      md5: a9964fb2cdd709a03fa775a68beb4516.dir
      size: 133918764
      nfiles: 4
    - path: out/models/localize
      md5: 529ae8075f37691487c4f46dbed278ee.dir
      size: 33478747
      nfiles: 1
    - path: out/runs/localize/metrics.json
      md5: 77be4d756d688415d6323d96c491cfbd
      size: 143
    - path: out/runs/localize/plots/metrics
      md5: f18c5892cef4d1e749881452ee48a5b5.dir
      size: 260
      nfiles: 2
    - path: out/runs/localize/tensorboard
      md5: e479b5400dc27fd5f93c73cad794c063.dir
      size: 3719
      nfiles: 3
  prepare_ocr:
    cmd: python3 -m src.ocr.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: fd29c6762b7ca129424e98d096800055.dir
      size: 356810637
      nfiles: 72
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: cb7ff1aa234850380b55a74e00004822
      size: 8454
    - path: src/datasets/swiss_license_plates_ocr_dataset.py
      md5: 451d9992a6899d41a3100f2049c1d6a0
      size: 2883
    - path: src/generators/swiss_license_plates_generator.py
      md5: 2ae6514797d244ee438f93229198e595
      size: 12413
    - path: src/ocr/prepare.py
      md5: 09134431f4b97c3810748e17f986ad8c
      size: 1809
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 6
          GRU_NUM_CLASSES: 11
          GRU_BLANK_CLASS: 10
        PrepareOCRParams:
          SEED: 25032023
          MAX_IMAGES: 50000
          TRAIN_SPLIT: 0.8
          IMG_SIZE:
          - 256
          - 256
    outs:
    - path: data/prepared/ocr
      md5: 867115d603efa6cd203169f8eca134a5.dir
      size: 443237394
      nfiles: 2
    - path: out/prepared/ocr/plots/images
      md5: 8700bd21a7b950655055ff2b0878d59a.dir
      size: 15605
      nfiles: 5
  train_ocr:
    cmd: python3 -m src.ocr.train
    deps:
    - path: data/prepared/ocr
      md5: 867115d603efa6cd203169f8eca134a5.dir
      size: 443237394
      nfiles: 2
    - path: src/models/cnn_ocr_model.py
      md5: 92e9cce6ae0a33ff9130c7f749bfb409
      size: 6494
    - path: src/ocr/train.py
      md5: 16b96a7c74f4134c9ad6b2d4095e45f1
      size: 1239
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    - path: src/utils/train.py
      md5: 3f001032823f9b609f598054d7150b8e
      size: 3975
    params:
      params.py:
        BATCH_SIZE: 32
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 14
          - 14
          GRU_HIDDEN_SIZE: 128
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.25
          RNN_AVGPOOL_SIZE:
          - 5
          - 5
          RNN_HIDDEN_LAYERS:
          - 1024
          - 512
          RNN_DROPOUT: 0.2
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 6
          GRU_NUM_CLASSES: 11
          GRU_BLANK_CLASS: 10
        TrainOCRParams:
          SEED: 25032023
          LR: 0.0001
          EPOCHS: 10
    outs:
    - path: out/checkpoints/ocr
      md5: 6ab66a3ddeed28b9a589cc6c24394057.dir
      size: 448222909
      nfiles: 10
    - path: out/models/ocr
      md5: e18089e75d1d0b54d9f2d39372caadcf.dir
      size: 44821196
      nfiles: 1
    - path: out/runs/ocr/metrics.json
      md5: a775a53070612c00cf301d93c11b4970
      size: 135
    - path: out/runs/ocr/plots/metrics
      md5: 00554494b13e8bd79e255f28a341ef92.dir
      size: 425
      nfiles: 2
    - path: out/runs/ocr/tensorboard
      md5: 39945d99dac79446c12b858a5ab870f6.dir
      size: 7319
      nfiles: 3
  evaluate_stack:
    cmd: python3 -m src.stack.evaluate
    deps:
    - path: data/prepared/stack
      md5: 0ce8cd175974654d7a785659b3746051.dir
      size: 221542823
      nfiles: 1
    - path: out/models/localize
      md5: 529ae8075f37691487c4f46dbed278ee.dir
      size: 33478747
      nfiles: 1
    - path: out/models/ocr
      md5: e18089e75d1d0b54d9f2d39372caadcf.dir
      size: 44821196
      nfiles: 1
    - path: src/stack/evaluate.py
      md5: b3c44986337310c1a134fbd1c687bd50
      size: 5438
    - path: src/utils/evaluation.py
      md5: 9b3c547872ebd9fe24c062799c09e517
      size: 1237
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/preview.py
      md5: a0538f1dd2c1ecc5184a13a746bda674
      size: 573
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.25
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 14
          - 14
          GRU_HIDDEN_SIZE: 128
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.25
          RNN_AVGPOOL_SIZE:
          - 5
          - 5
          RNN_HIDDEN_LAYERS:
          - 1024
          - 512
          RNN_DROPOUT: 0.2
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 6
          GRU_NUM_CLASSES: 11
          GRU_BLANK_CLASS: 10
    outs:
    - path: out/evaluations/stack/metrics.json
      md5: 6a41c3d1e71bb8ef330c86563eae9aee
      size: 39
    - path: out/evaluations/stack/plots/images
      md5: 239a3ab5ff42bfa8fd019feaaff6db73.dir
      size: 1446759
      nfiles: 11
  evaluate_ocr:
    cmd: python3 -m src.ocr.evaluate
    deps:
    - path: out/models/ocr
      md5: e18089e75d1d0b54d9f2d39372caadcf.dir
      size: 44821196
      nfiles: 1
    - path: src/ocr/evaluate.py
      md5: 57e057173c7b79b85cf34cb804170d5f
      size: 2705
    - path: src/utils/evaluation.py
      md5: 9b3c547872ebd9fe24c062799c09e517
      size: 1237
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 14
          - 14
          GRU_HIDDEN_SIZE: 128
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.25
          RNN_AVGPOOL_SIZE:
          - 5
          - 5
          RNN_HIDDEN_LAYERS:
          - 1024
          - 512
          RNN_DROPOUT: 0.2
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 6
          GRU_NUM_CLASSES: 11
          GRU_BLANK_CLASS: 10
    outs:
    - path: out/evaluations/ocr/plots/images
      md5: 289e9e3beca520a66d30dfef1208a991.dir
      size: 576891
      nfiles: 10
  evaluate_localize:
    cmd: python3 -m src.localize.evaluate
    deps:
    - path: out/models/localize
      md5: 529ae8075f37691487c4f46dbed278ee.dir
      size: 33478747
      nfiles: 1
    - path: src/localize/evaluate.py
      md5: 6cbcb8c8d63d928616302a55a1653bdc
      size: 1739
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/preview.py
      md5: a0538f1dd2c1ecc5184a13a746bda674
      size: 573
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.25
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
    outs:
    - path: out/evaluations/localize/plots/images
      md5: c1c6540b9b4c349b07f22182563ba8b6.dir
      size: 66563
      nfiles: 10
