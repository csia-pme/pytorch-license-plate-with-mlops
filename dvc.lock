schema: '2.0'
stages:
  prepare_localize:
    cmd: python3 -m src.localize.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: 59bae5f83c275d47d1de1b421cc0c904.dir
      size: 356813768
      nfiles: 74
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 0c8000140097a7ecab0b541e53d006fe
      size: 8437
    - path: src/generators/swiss_license_plates_generator.py
      md5: 5eca5b809dccadee29f64a29a2ee3199
      size: 12384
    - path: src/localize/prepare.py
      md5: ae58919eb14fcd2fd81d19f5861bc2e2
      size: 1799
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        PrepareLocalizeParams:
          SEED: 25032023
          MAX_IMAGES: 100000
          TRAIN_SPLIT: 0.8
    outs:
    - path: data/prepared/localize
      md5: f7ca47d2af1c94e6ad950b775da70545.dir
      size: 443454354
      nfiles: 2
    - path: out/prepared/localize/plots/images
      md5: caa4519fd06352333940dc634f3520b6.dir
      size: 17470
      nfiles: 5
  train_localize:
    cmd: python3 -m src.localize.train
    deps:
    - path: data/prepared/localize
      md5: f7ca47d2af1c94e6ad950b775da70545.dir
      size: 443454354
      nfiles: 2
    - path: src/localize/train.py
      md5: 0858715e0143dfcfbc97dd27e8a6e885
      size: 1322
    - path: src/models/cnn_localizer_model.py
      md5: a380c4d202c6bcd726d923df1cbf2de1
      size: 3330
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    - path: src/utils/train.py
      md5: 3f001032823f9b609f598054d7150b8e
      size: 3975
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.4
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        TrainLocalizeParams:
          SEED: 25032023
          LR: 0.0005
          EPOCHS: 3
    outs:
    - path: out/checkpoints/localize
      md5: 2843869103a5b833b5737e3d987f30b2.dir
      size: 100439073
      nfiles: 3
    - path: out/models/localize
      md5: 1b31f33cc2ed0f756256115b9f5c0a27.dir
      size: 33478747
      nfiles: 1
    - path: out/runs/localize/metrics.json
      md5: d991817d509f1b0e3298960d73f677ac
      size: 142
    - path: out/runs/localize/plots/metrics
      md5: 48f2fb2b995cd90a524d4e3e11e623d7.dir
      size: 166
      nfiles: 2
    - path: out/runs/localize/tensorboard
      md5: 7137cb65734b13d9aec8ac86f2e43764.dir
      size: 4043
      nfiles: 3
  evaluate_localize:
    cmd: python3 -m src.localize.evaluate
    deps:
    - path: out/models/localize
      md5: 1b31f33cc2ed0f756256115b9f5c0a27.dir
      size: 33478747
      nfiles: 1
    - path: src/localize/evaluate.py
      md5: 019a77986d597074e266d1ce2b835e2a
      size: 1770
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/preview.py
      md5: a0538f1dd2c1ecc5184a13a746bda674
      size: 573
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.4
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
    outs:
    - path: out/evaluations/localize/plots/images
      md5: ca849dd8d98c9fcb6843a3c2fb097a2e.dir
      size: 67996
      nfiles: 10
  prepare_ocr:
    cmd: python3 -m src.ocr.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: 59bae5f83c275d47d1de1b421cc0c904.dir
      size: 356813768
      nfiles: 74
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 0c8000140097a7ecab0b541e53d006fe
      size: 8437
    - path: src/datasets/swiss_license_plates_ocr_dataset.py
      md5: 1145dd87bb216ae5c754d4cee6fca1cd
      size: 2921
    - path: src/generators/swiss_license_plates_generator.py
      md5: 5eca5b809dccadee29f64a29a2ee3199
      size: 12384
    - path: src/ocr/prepare.py
      md5: 8a6f9936bf56b0fb7dda78830eba2ada
      size: 1819
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 7
          GRU_NUM_CLASSES: 37
          GRU_BLANK_CLASS: 36
        PrepareOCRParams:
          SEED: 25032023
          MAX_IMAGES: 250000
          TRAIN_SPLIT: 0.8
          IMG_SIZE:
          - 256
          - 256
    outs:
    - path: data/prepared/ocr
      md5: a3a9bbc072d7801c7b1016dd780f4088.dir
      size: 444206482
      nfiles: 2
    - path: out/prepared/ocr/plots/images
      md5: 3f1c0763f14a5b1acbebe292feea748b.dir
      size: 15835
      nfiles: 5
  train_ocr:
    cmd: python3 -m src.ocr.train
    deps:
    - path: data/prepared/ocr
      md5: a3a9bbc072d7801c7b1016dd780f4088.dir
      size: 444206482
      nfiles: 2
    - path: src/models/cnn_ocr_model.py
      md5: d672a8524c6d769f9646d65193934bac
      size: 4353
    - path: src/ocr/train.py
      md5: a052094857572d14eaece7df9863aabf
      size: 1252
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    - path: src/utils/train.py
      md5: 3f001032823f9b609f598054d7150b8e
      size: 3975
    params:
      params.py:
        BATCH_SIZE: 32
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 18
          - 18
          GRU_HIDDEN_SIZE: 384
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.5
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 7
          GRU_NUM_CLASSES: 37
          GRU_BLANK_CLASS: 36
        TrainOCRParams:
          SEED: 25032023
          LR: 0.00025
          EPOCHS: 2
    outs:
    - path: out/checkpoints/ocr
      md5: 38dc2aa4c73ec869355219a5d6f9bd3a.dir
      size: 121236746
      nfiles: 2
    - path: out/models/ocr
      md5: 3e0980fdc26cb1a5469fc2cbf558c8a9.dir
      size: 60617642
      nfiles: 1
    - path: out/runs/ocr/metrics.json
      md5: d8670f435bba793eddc0bbbfdb1a6015
      size: 138
    - path: out/runs/ocr/plots/metrics
      md5: 0ae2a4cbf0f45ed39cafe87ad22b2e86.dir
      size: 109
      nfiles: 2
    - path: out/runs/ocr/tensorboard
      md5: c53ccf540935ee7fed1a16790084ee41.dir
      size: 6459
      nfiles: 3
  evaluate_ocr:
    cmd: python3 -m src.ocr.evaluate
    deps:
    - path: out/models/ocr
      md5: 3e0980fdc26cb1a5469fc2cbf558c8a9.dir
      size: 60617642
      nfiles: 1
    - path: src/ocr/evaluate.py
      md5: 817a31e13242f39417a1e9fcb7a78089
      size: 2676
    - path: src/utils/evaluation.py
      md5: 5e10ef201d3a746c41cba0b2a07b04a6
      size: 1654
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 18
          - 18
          GRU_HIDDEN_SIZE: 384
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.5
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 7
          GRU_NUM_CLASSES: 37
          GRU_BLANK_CLASS: 36
    outs:
    - path: out/evaluations/ocr/plots/images
      md5: c757017e1551461ff83f549d73e0abb8.dir
      size: 815205
      nfiles: 10
  prepare_stack:
    cmd: python3 -m src.stack.prepare
    deps:
    - path: data/datasets/swiss_templates
      md5: 59bae5f83c275d47d1de1b421cc0c904.dir
      size: 356813768
      nfiles: 74
    - path: src/datasets/swiss_license_plates_dataset.py
      md5: 0c8000140097a7ecab0b541e53d006fe
      size: 8437
    - path: src/generators/swiss_license_plates_generator.py
      md5: 5eca5b809dccadee29f64a29a2ee3199
      size: 12384
    - path: src/stack/prepare.py
      md5: 5108e1d7a61eb4be90fbb8ab59c49088
      size: 1195
    - path: src/utils/dataset.py
      md5: 36ccdf1cca892a2bde90d810c73c7791
      size: 2317
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        BATCH_SIZE: 32
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        PrepareOCRParams:
          SEED: 25032023
          MAX_IMAGES: 250000
          TRAIN_SPLIT: 0.8
          IMG_SIZE:
          - 256
          - 256
        PrepareStackParams:
          SEED: 25032023
          MAX_IMAGES: 5000
    outs:
    - path: data/prepared/stack
      md5: be9e0489eee555b983478d25d4e9d7b9.dir
      size: 221542631
      nfiles: 1
  evaluate_stack:
    cmd: python3 -m src.stack.evaluate
    deps:
    - path: data/prepared/stack
      md5: be9e0489eee555b983478d25d4e9d7b9.dir
      size: 221542631
      nfiles: 1
    - path: out/models/localize
      md5: 1b31f33cc2ed0f756256115b9f5c0a27.dir
      size: 33478747
      nfiles: 1
    - path: out/models/ocr
      md5: 3e0980fdc26cb1a5469fc2cbf558c8a9.dir
      size: 60617642
      nfiles: 1
    - path: src/stack/evaluate.py
      md5: bdae368fef231ea3fb332a48b3f80bc5
      size: 5225
    - path: src/utils/evaluation.py
      md5: 5e10ef201d3a746c41cba0b2a07b04a6
      size: 1654
    - path: src/utils/model.py
      md5: 1c37662db96a47d248e944a5c4930461
      size: 1199
    - path: src/utils/preview.py
      md5: a0538f1dd2c1ecc5184a13a746bda674
      size: 573
    - path: src/utils/seed.py
      md5: f94e3941728b5363f37f1139fc21cf24
      size: 736
    params:
      params.py:
        LocalizeModelParams:
          MODEL_NAME: plate_localizer_v3
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 512
          - M
          AVGPOOL_SIZE:
          - 5
          - 5
          HIDDEN_LAYERS:
          - 512
          - 512
          DROPOUT: 0.4
        LocalizeParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
        OCRModelParams:
          MODEL_NAME: plate_ocr_v2
          CONV_LAYERS:
          - 64
          - M
          - 128
          - M
          - 256
          - M
          - 256
          - M
          GRU_AVGPOOL_SIZE:
          - 18
          - 18
          GRU_HIDDEN_SIZE: 384
          GRU_NUM_LAYERS: 2
          GRU_DROPOUT: 0.5
        OCRParams:
          IMG_SHAPE:
          - 1
          - 84
          - 84
          MAX_LABEL_LENGTH: 7
          GRU_NUM_CLASSES: 37
          GRU_BLANK_CLASS: 36
    outs:
    - path: out/evaluations/stack/metrics.json
      md5: 3ed64981c7255875c92424ef28187869
      size: 28
    - path: out/evaluations/stack/plots/images
      md5: 738bfa05782fe5bff4f0caeda90f5cad.dir
      size: 2314406
      nfiles: 11
